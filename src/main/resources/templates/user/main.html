<!DOCTYPE html>
<html lang="en">
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
</head>

<body>
<div class="container">
    <div class="input-group">
        <span class="input-group-text">회원가입테스트</span>
        <input type="text" aria-label="Last name" class="form-control" id="username" name="username">
        <input type="text" aria-label="Third name" class="form-control" id="password" name="password">
        <button type="button" class="btn btn-primary" id="join">회원가입</button>
    </div>
    <div id="area">

    </div>

    <div class="input-group">
        <span class="input-group-text">로그인테스트</span>
        <input type="text" aria-label="First name" class="form-control" id="username1">
        <input type="text" aria-label="Last name" class="form-control" id="password1">
        <button type="button" class="btn btn-primary" id="login">로그인</button>
    </div>
    <div id="area_login">

    </div>


    <div class="input-group">
        <span class="input-group-text">데이터 요청</span>
        <button type="button" class="btn btn-primary" id="data">데이터 요청</button>
    </div>
    <div id="area_logout">

        <img th:src="@{/user/img/carousel-1.jpg}" alt=""/>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>

        document.getElementById("login").addEventListener('click', loginTest);
        document.getElementById("join").addEventListener('click', joinTest);
        document.getElementById("data").addEventListener('click', getData3);

        axios.defaults.withCredentials = true;

        function getData() {
            axios.get('/api/v1/resource')
                .then((result) => {
                    console.log(result.data)
                }).catch(() => {
                console.log('에러남')
            })
        }

        function getCookie(name) {
            let matches = document.cookie.match(new RegExp(
                "(?:^|; )" + name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + "=([^;]*)"
            ));
            return matches ? decodeURIComponent(matches[1]) : undefined;
        }

        async function getData3() {
            let response = await fetch("/api/v1/resource", {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                    credentials: "include",
                    // "Authorization": getCookie("token")
                }
            })
            if (response.ok) {
                console.log(await response);
                let json = await response.json();
                document.getElementById("area_login").innerHTML = json.result;
            } else {
                console.log(await response);
                let json = await response.text();
                document.getElementById("area_login").innerHTML = json;
            }

        }

        async function getData2() {
            await fetch("/api/v1/resource", {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                    credentials: "include"
                }
            }).then(res => res.json())
                .then(json => {
                    console.log(json.result)
                })
        }

        async function joinTest() {
            let response = await fetch("/api/v1/auth/signup", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    username: document.getElementById("username").value,
                    password: document.getElementById("password").value
                })
            })
            if (response.ok) {
                console.log(await response);
                let json = await response.json();
                document.getElementById("area_login").innerHTML = json.result;
            } else {
                console.log(await response);
                let json = await response.text();
                document.getElementById("area_login").innerHTML = json;
            }

        }


        async function loginTest() {
            let response = await fetch("/api/v1/auth/signin", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    username: document.getElementById("username1").value,
                    password: document.getElementById("password1").value
                })
            })
            if (response.ok) {
                console.log(await response);
                let json = await response.json();
                document.getElementById("area_login").innerHTML = json.result;
            } else {
                console.log(await response);
                let json = await response.text();
                document.getElementById("area_login").innerHTML = json;
            }

        }

        async function logout() {
            localStorage.clear();
            document.getElementById("area_logout").innerHTML = "로그아웃 성공";
        }

    </script>
</div>


</body>

</html>