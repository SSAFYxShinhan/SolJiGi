<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Game</title>
    <link href="/css/style.css" rel="stylesheet">
    <link href="/css/game/match-card.css" rel="stylesheet">
    <link href="/css/game/same-picture.css" rel="stylesheet">
    <script src="/js/script.js"></script>
    <script src="/js/game/match-card.js"></script>
    <script src="/js/game/same-picture.js"></script>
    <script src="/js/game/choice-quiz.js"></script>

    <style>
        .gameContainer {
            background-color: lightgray;
            width: 600px;
            height: 600px;
        }
    </style>
</head>
<body>
<div id="layout">
    <form>
        <div class="game-header">
            <div class="game-timer">

            </div>
        </div>
        <div class="gameContainer">

        </div>
    </form>
    <button class="game-next-btn" onclick="nextGame()">Next</button>
</div>

<script th:inline="javascript">
    const quiz = {
        question: "이 문제의 답은?",
        choice: ["1sf", "2sdfs", "3sdf", "4sdf"],
        answer: 1,
    };

    let result = [0, 0, 0, 0];
    const container = document.querySelector('.gameContainer');
    const questions = [[${quizzes}]];
    const matchCardCount = [[${matchCard}]];
    const samePictureCount = [[${samePicture}]];
    let currGame;

    for (let i = 0; i < matchCardCount; ++i)
        questions.push(gameType.MATCH_CARD);
    for (let i = 0; i < samePictureCount; ++i)
        questions.push(gameType.SAME_PICTURE);

    shuffle(questions);

    console.log(questions);

    let gameIdx = 0;
    updateView(questions[gameIdx++]);

    function updateView(game) {
        if (game === gameType.MATCH_CARD) {
            currGame = new MatchCardGame(container, 2, 2, 25, result);
        } else if (game === gameType.SAME_PICTURE) {
            currGame = new SamePictureGame(container, 2, 2, 25, result);
        } else {
            currGame = new ChoiceQuizGame(container, quiz, 5, result);
        }
    }

    function nextGame() {
        if (gameIdx === questions.length) {
            alert('게임이 종료되었습니다.');
            container.innerHTML = `'결과 화면 이동 로직 작성 ${result}`;
            return;
        }

        if (currGame && currGame.gameState === state.GAME) {
            alert('아직 진행중인 게임이 있습니다.');
            return;
        }
        currGame = null;
        updateView(questions[gameIdx++]);
    }

    function rand(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function shuffle(array) {
        array.sort(() => Math.random() - 0.5);
    }
</script>

</body>

</html>